<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analisis Mendalam: Arsitektur IoT Greenhouse</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <h1>Analisis Arsitektur Sistem IoT Greenhouse</h1>
      <p>Studi Kasus Peran Simbiotik antara Sensor Node dan Gateway</p>
    </header>

    <main class="container">
      <section class="section" id="diagram-section">
        <h2><span class="icon">üèóÔ∏è</span> Diagram Arsitektur Sistem</h2>
        <p>
          Diagram ini mengilustrasikan komponen utama dan alur komunikasi dalam
          sistem. Klik pada setiap komponen untuk mendapatkan penjelasan detail.
        </p>
        <div class="diagram-container">
          <!-- SVG Diagram akan di-load oleh JavaScript -->
        </div>
        <div class="info-panel" id="info-panel">
          <h3>Selamat Datang!</h3>
          <p>
            Klik salah satu komponen pada diagram di atas untuk melihat
            deskripsi detail perannya dalam sistem.
          </p>
        </div>
      </section>

      <section class="section">
        <h2><span class="icon">üéØ</span> Peran dan Fitur Unggulan</h2>
        <div class="tabs">
          <button class="tab-button active" data-tab="node-tab">
            Sensor Node
          </button>
          <button class="tab-button" data-tab="gateway-tab">Gateway</button>
        </div>
        <div id="node-tab" class="tab-content active">
          <h3>Sensor Node: Pengumpul Data yang Tangguh dan Andal</h3>
          <p>
            Sensor Node adalah unit pekerja keras di lapangan. Perannya sangat
            terspesialisasi: mengukur kondisi lingkungan dengan akurat dan
            memastikan setiap data sampai ke server, apapun yang terjadi. Ia
            adalah perwujudan dari filosofi "Integritas Data Di Atas Segalanya".
          </p>
          <h4>Fitur Unggulan:</h4>
          <ul class="feature-list">
            <li>
              <strong>Caching dengan <em>Binary Ring Buffer</em>:</strong> Fitur
              paling kritis. Jika koneksi WiFi putus, data tidak hilang. Data
              akan disimpan dalam format biner yang efisien di satu file tunggal
              pada memori flash. Mekanisme ini meminimalkan "keausan" pada
              memori dan sangat cepat. Ketika koneksi pulih, antrian data akan
              dikirim secara otomatis.
            </li>
            <li>
              <strong>Desain <em>Headless</em> dan Minimalis:</strong> Tidak ada
              layar, tidak ada tombol. Ini membuatnya murah untuk diproduksi
              massal, hemat daya, dan memiliki lebih sedikit titik kegagalan.
              Semua diagnostik dan konfigurasi dilakukan dari jarak jauh melalui
              terminal WebSerial.
            </li>
            <li>
              <strong>Pemulihan Sensor Otomatis:</strong> Jika sensor I2C macet
              (masalah umum di lapangan), Node akan mencoba memulihkan bus I2C
              secara otomatis dengan "menggoyangkan" jalur clock, sebelum
              mencoba menginisialisasi ulang sensor.
            </li>
            <li>
              <strong>Kalibrasi <em>Compile-Time</em>:</strong> Setiap node
              fisik dapat memiliki nilai kalibrasi sensor yang unik yang
              ditentukan saat kompilasi berdasarkan <code>NODE_ID</code>. Ini
              memungkinkan satu basis kode untuk semua node, namun dengan
              kalibrasi yang presisi.
            </li>
          </ul>
        </div>
        <div id="gateway-tab" class="tab-content">
          <h3>Gateway: Pusat Komando yang Selalu Terhubung</h3>
          <p>
            Gateway adalah otak sekaligus tangan dari sistem. Ia tidak hanya
            meneruskan data, tetapi secara aktif mengambil keputusan dan
            bertindak. Desainnya berpusat pada filosofi "Ketersediaan dan
            Keamanan Operasional Maksimal".
          </p>
          <h4>Fitur Unggulan:</h4>
          <ul class="feature-list">
            <li>
              <strong><em>Dual-Network Redundancy (WiFi + GPRS)</em>:</strong>
              Gateway selalu berusaha terhubung. Ia memprioritaskan WiFi, tetapi
              jika gagal, modem seluler SIM800L akan mengambil alih secara
              otomatis. Ia bahkan akan secara berkala memeriksa apakah WiFi
              sudah pulih untuk beralih kembali.
            </li>
            <li>
              <strong>Logika <em>Failsafe</em>:</strong> Jika Gateway kehilangan
              koneksi ke server API untuk waktu yang lama, ia akan masuk ke mode
              aman, mematikan semua relay untuk mencegah kerusakan pada tanaman.
            </li>
            <li>
              <strong><em>Persistent State</em> dengan NVS:</strong> Perintah
              manual (override) dari pengguna, seperti "paksa nyalakan kipas",
              disimpan di Non-Volatile Storage (NVS). Artinya, jika Gateway mati
              listrik dan hidup lagi, perintah override tersebut akan tetap
              diingat dan dilanjutkan.
            </li>
            <li>
              <strong>Manajemen Waktu dengan Hardware RTC (DS3231):</strong>
              Gateway membutuhkan waktu yang akurat untuk logging, bahkan saat
              offline. Modul RTC dengan baterai cadangan memastikan timestamp
              selalu benar.
            </li>
          </ul>
        </div>
      </section>

      <section class="section">
        <h2><span class="icon">üíª</span> Antarmuka Konfigurasi & Manajemen</h2>
        <p>
          Gateway, sebagai pusat kendali, dilengkapi dengan antarmuka web yang
          kuat untuk memudahkan penyiapan awal dan pemeliharaan firmware. Mari
          kita simulasikan cara kerjanya.
        </p>

        <div class="portal-simulation-grid">
          <div class="portal-description">
            <h4>1. Captive Portal untuk Konfigurasi WiFi Awal</h4>
            <p>
              Ketika Gateway dinyalakan pertama kali, ia akan membuat Access
              Point sendiri. Simulasi di samping menunjukkan pengalaman pengguna
              saat menghubungkan perangkat baru.
            </p>
            <strong>Cara Kerja di Balik Layar:</strong>
            <ol>
              <li>
                <strong>Mode AP:</strong> Gateway membuat jaringan WiFi, misal
                <code>Gateway-Config-1</code>.
              </li>
              <li>
                <strong>DNS Hijacking:</strong> Saat ponsel Anda terhubung,
                Gateway "membajak" permintaan internet dan mengarahkannya ke
                halaman konfigurasinya sendiri.
              </li>
              <li>
                <strong>Penyimpanan Aman:</strong> Kredensial yang Anda masukkan
                disimpan di memori NVS (Non-Volatile Storage).
              </li>
              <li>
                <strong>Reboot & Koneksi:</strong> Perangkat reboot dan
                menggunakan kredensial baru untuk terhubung ke jaringan WiFi
                Anda.
              </li>
            </ol>
            <div class="simulation-controls">
              <button class="sim-button" id="start-captive-sim">
                Jalankan Simulasi Captive Portal
              </button>
            </div>
          </div>
          <div class="phone-mockup">
            <div class="phone-screen" id="captive-portal-screen">
              <p>Klik tombol simulasi untuk memulai...</p>
            </div>
          </div>
        </div>

        <div class="portal-simulation-grid reverse">
          <div class="portal-description">
            <h4>2. Portal Update Firmware (OTA) via Web</h4>
            <p>
              Untuk mempermudah pembaruan firmware, Gateway menyediakan halaman
              web khusus di alamat IP-nya (misal: <code>/update</code>).
            </p>
            <strong>Cara Kerja di Balik Layar:</strong>
            <ol>
              <li>
                <strong>Otentikasi:</strong> Halaman ini dilindungi kata sandi.
              </li>
              <li>
                <strong>Upload Bertahap:</strong> Firmware baru (file
                <code>.bin</code>) dikirim dalam potongan-potongan (chunks)
                untuk menghemat RAM.
              </li>
              <li>
                <strong>Penulisan ke Partisi OTA:</strong> ESP32 menulis
                firmware baru ke partisi yang sedang tidak aktif, tanpa
                mengganggu operasi yang sedang berjalan.
              </li>
              <li>
                <strong>Aktivasi & Reboot:</strong> Setelah upload 100% dan
                terverifikasi, bootloader diinstruksikan untuk menggunakan
                partisi baru pada saat reboot berikutnya.
              </li>
            </ol>
            <div class="simulation-controls">
              <button class="sim-button" id="start-ota-sim">
                Jalankan Simulasi Update OTA
              </button>
            </div>
          </div>
          <div class="browser-mockup">
            <div class="browser-header">
              <span class="dot"></span><span class="dot"></span
              ><span class="dot"></span>
            </div>
            <div class="browser-content" id="ota-portal-content">
              <p>Klik tombol simulasi untuk memulai...</p>
            </div>
          </div>
        </div>
      </section>

      <section class="section">
        <h2>
          <span class="icon">‚å®Ô∏è</span> Fitur Diagnostik: Terminal WebSerial
        </h2>
        <p>
          Kedua perangkat dilengkapi dengan terminal WebSocket untuk diagnostik
          dan administrasi jarak jauh, namun dengan fungsionalitas yang sangat
          berbeda sesuai perannya.
        </p>
        <div class="terminal-container">
          <div class="terminal-wrapper">
            <h3>Terminal Sensor Node</h3>
            <p>
              Fokus pada diagnostik mendalam, konfigurasi, dan debugging fitur
              inti seperti caching dan sensor.
            </p>
            <div class="terminal-screen" id="node-terminal-screen"></div>
            <div class="terminal-input-bar">
              <span class="prompt">></span
              ><input
                type="text"
                placeholder="Simulasi sedang berjalan..."
                readonly
              />
            </div>
            <div class="simulation-controls">
              <button class="sim-button" id="start-node-terminal-sim">
                Jalankan Simulasi
              </button>
            </div>
          </div>
          <div class="terminal-wrapper">
            <h3>Terminal Gateway</h3>
            <p>
              Fokus pada pemantauan status tingkat tinggi dan tindakan cepat. UI
              lebih ramah pengguna.
            </p>
            <div class="terminal-screen" id="gateway-terminal-screen"></div>
            <div class="terminal-input-bar">
              <span class="prompt">></span
              ><input
                type="text"
                placeholder="Simulasi sedang berjalan..."
                readonly
              />
            </div>
            <div class="simulation-controls">
              <button class="sim-button" id="start-gateway-terminal-sim">
                Jalankan Simulasi
              </button>
            </div>
          </div>
        </div>
      </section>

      <section class="section">
        <h2><span class="icon">‚öôÔ∏è</span> Simulasi Alur Kerja Sistem</h2>
        <div class="tabs">
          <button class="tab-button active" data-tab="node-sim-tab">
            Simulasi Sensor Node
          </button>
          <button class="tab-button" data-tab="gateway-sim-tab">
            Simulasi Gateway
          </button>
        </div>
        <div id="node-sim-tab" class="tab-content active">
          <h4>Alur Kerja Sensor Node (Fokus pada Caching)</h4>
          <p>
            Simulasi ini menunjukkan bagaimana Sensor Node menangani pengiriman
            data dan apa yang terjadi saat koneksi terputus.
          </p>
          <div class="flow-simulation" id="node-flow-container"></div>
          <div class="simulation-controls">
            <button class="sim-button" id="start-node-simulation">
              Jalankan Simulasi
            </button>
          </div>
        </div>
        <div id="gateway-sim-tab" class="tab-content">
          <h4>Alur Kerja Gateway (Fokus pada Kontrol & Redundansi)</h4>
          <p>
            Simulasi ini menunjukkan bagaimana Gateway membuat keputusan,
            mengontrol relay, dan menangani kegagalan jaringan WiFi.
          </p>
          <div class="flow-simulation" id="gateway-flow-container"></div>
          <div class="simulation-controls">
            <button class="sim-button" id="start-gateway-simulation">
              Jalankan Simulasi
            </button>
          </div>
        </div>
      </section>

      <section class="section">
        <h2><span class="icon">üìä</span> Tabel Perbandingan Rangkuman</h2>
        <p>
          Perbedaan utama antara kedua perangkat ini bukanlah kekurangan,
          melainkan spesialisasi yang disengaja untuk menciptakan sistem yang
          efisien dan tangguh.
        </p>
        <div class="comparison-table-wrapper">
          <table class="comparison-table">
            <thead>
              <tr>
                <th>Fitur</th>
                <th>Sensor Node</th>
                <th>Gateway</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Peran Utama</td>
                <td>Produsen Data (Mengukur & Mengirim)</td>
                <td>Pengendali (Berpikir & Bertindak)</td>
              </tr>
              <tr>
                <td>Konektivitas</td>
                <td>WiFi Saja</td>
                <td><strong>WiFi + GPRS (Seluler)</strong> sebagai cadangan</td>
              </tr>
              <tr>
                <td>Strategi Saat Offline</td>
                <td>
                  <strong>Menyimpan data di Cache</strong> untuk dikirim nanti
                </td>
                <td>Masuk ke <strong>Mode Aman (Failsafe)</strong></td>
              </tr>
              <tr>
                <td>Kontrol Perangkat Keras</td>
                <td>Tidak ada (hanya membaca sensor)</td>
                <td>Mengontrol 4 Relay (kipas, dll.)</td>
              </tr>
              <tr>
                <td>Antarmuka Lokal</td>
                <td>Tidak ada (Headless)</td>
                <td><strong>Layar LCD 20x4</strong> untuk status real-time</td>
              </tr>
              <tr>
                <td>Manajemen Waktu</td>
                <td>Sinkronisasi NTP (saat online)</td>
                <td>
                  <strong>Modul RTC Hardware</strong> (selalu akurat) + NTP
                </td>
              </tr>
              <tr>
                <td>Persistensi Status</td>
                <td>Hanya Konfigurasi</td>
                <td><strong>Konfigurasi & Override Relay (NVS)</strong></td>
              </tr>
              <tr>
                <td>Fitur Unggulan</td>
                <td>Caching data yang sangat andal</td>
                <td>Redundansi jaringan dan logika failsafe</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer><p>Dibuat untuk edukasi internal. &copy; 2024</p></footer>
    <script src="script.js"></script>
  </body>
</html>
